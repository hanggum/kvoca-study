<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™ìƒ ë¡œê·¸ì¸ - ì–´íœ˜ë‚˜ë¼</title>
    <link rel="stylesheet" href="../css/style.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container navbar-content">
            <a href="login.html" class="navbar-brand">âœ¨ ì–´íœ˜ë‚˜ë¼ (í•™ìƒìš©)</a>
            <ul class="navbar-menu">
                <!-- Isolated Entry -->
            </ul>
        </div>
    </nav>

    <!-- Login Section -->
    <section class="hero">
        <div class="container">
            <div class="glass-card" style="max-width: 500px; margin: 0 auto;">
                <div class="text-center mb-4">
                    <h1>ğŸ“ í•™ìƒ ë¡œê·¸ì¸</h1>
                    <p class="card-text">ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
                </div>

                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label" for="teacherCode">ì„ ìƒë‹˜ ì½”ë“œ (5ìë¦¬)</label>
                        <input type="text" id="teacherCode" class="form-input" placeholder="ì„ ìƒë‹˜ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”" maxlength="5"
                            pattern="[0-9]{5}" required>
                        <small
                            style="color: var(--text-muted); font-size: 0.8rem; display: block; margin-top: 0.25rem;">
                            ì„ ìƒë‹˜ê»˜ ë°›ì€ 5ìë¦¬ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”
                        </small>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="username">ì•„ì´ë””</label>
                        <input type="text" id="username" class="form-input" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="password">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="password" class="form-input" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                    </div>

                    <div id="errorMessage" class="hidden"
                        style="color: var(--secondary-500); margin-bottom: 1rem; text-align: center;"></div>

                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        ë¡œê·¸ì¸
                    </button>
                </form>

                <div class="mt-4"
                    style="padding: 1rem; background: var(--bg-dark-tertiary); border-radius: var(--radius-md);">
                    <p style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
                        <strong>ğŸ’¡ í…ŒìŠ¤íŠ¸ ê³„ì •:</strong>
                    </p>
                    <p style="font-size: 0.875rem; color: var(--text-muted); margin: 0.25rem 0;">
                        ì•„ì´ë””: student1, student2, student3
                    </p>
                    <p style="font-size: 0.875rem; color: var(--text-muted); margin: 0.25rem 0;">
                        ë¹„ë°€ë²ˆí˜¸: 1234
                    </p>
                </div>
            </div>

            <!-- Demo Info Cards -->
            <div class="grid grid-3 mt-5" style="max-width: 900px; margin-left: auto; margin-right: auto;">
                <div class="card text-center">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“‡</div>
                    <h4>í”Œë˜ì‹œì¹´ë“œ</h4>
                    <p class="card-text" style="font-size: 0.875rem;">
                        ì¹´ë“œë¥¼ ë„˜ê¸°ë©°<br>ì–´íœ˜ë¥¼ ìµí˜€ìš”
                    </p>
                </div>
                <div class="card text-center">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">âœï¸</div>
                    <h4>ë”°ë¼ ì“°ê¸° ì—°ìŠµ</h4>
                    <p class="card-text" style="font-size: 0.875rem;">
                        ëœ»ì„ 3ë²ˆ ë”°ë¼<br>ì•”ê¸°í•´ìš”
                    </p>
                </div>
                <div class="card text-center">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">âœï¸</div>
                    <h4>ë¬¸ì¥ ë§Œë“¤ê¸°</h4>
                    <p class="card-text" style="font-size: 0.875rem;">
                        ì°½ì˜ì ì¸ ë¬¸ì¥ì„<br>ë§Œë“¤ì–´ìš”
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Config & Data Service -->
    <script src="../js/firebase-config.js"></script>
    <script src="../js/data-service.js"></script>
    <script src="../js/auth.js"></script>
    <script>
        // Check if already logged in
        if (auth.isLoggedIn() && auth.getCurrentUser().role === 'student') {
            window.location.href = 'dashboard.html';
        }

        const loginForm = document.getElementById('loginForm');
        const errorMessage = document.getElementById('errorMessage');
        const teacherCodeInput = document.getElementById('teacherCode');

        // Add numeric-only validation to teacher code input
        teacherCodeInput.addEventListener('input', (e) => {
            e.target.value = e.target.value.replace(/[^0-9]/g, '');
        });

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const teacherCode = teacherCodeInput.value.trim();

            if (!teacherCode || teacherCode.length !== 5) {
                errorMessage.textContent = '5ìë¦¬ ì„ ìƒë‹˜ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                errorMessage.classList.remove('hidden');
                return;
            }

            // Wait for auth login with teacherCode
            const result = await auth.login(username, password, 'student', teacherCode);

            if (result.success) {
                // Successful login
                window.location.href = 'dashboard.html';
            } else {
                // Show error
                errorMessage.textContent = result.message;
                errorMessage.classList.remove('hidden');

                // Shake animation
                loginForm.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    loginForm.style.animation = '';
                }, 500);
            }
        });

        // Add shake animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
                20%, 40%, 60%, 80% { transform: translateX(10px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>

</html>